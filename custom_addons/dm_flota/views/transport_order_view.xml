<?xml version="1.0" encoding="UTF-8" ?>
<odoo>

    <record id="dm_f_transport_order_view_tree" model="ir.ui.view">
        <field name="name">dm.f.transport.order.view.tree</field>
        <field name="model">transport.order</field>
        <field name="arch" type="xml">
            <tree string="Transport orders">
                <!--          TODO            decoration-info="state == 'draft'"-->
                <!--           TODO           decoration-muted="state == 'cancel'"-->
                <field name="name"/>
                <field name="partner_id" invisible="1"/>
                <field name="total_gross" sum="Total gross" optional="show"/>
                <field name="currency_id" invisible="1"/>
            </tree>
        </field>
    </record>

    <record id="dm_f_transport_order_view_form" model="ir.ui.view">
        <field name="name">>dm.f.transport.order.view.form</field>
        <field name="model">transport.order</field>
        <field name="arch" type="xml">
            <form string="Transport Order">
                <header>
                    <!-- Post -->
                    <!--                        <button name="action_post" string="Post" class="oe_highlight"-->
                    <!--                                type="object" groups="account.group_account_invoice"-->
                    <!--                                attrs="{'invisible': [('state', '!=', 'draft')]}"/>-->
                    <!--                        &lt;!&ndash; Send (only invoices) &ndash;&gt;-->
                    <!--                        <button name="action_invoice_sent"-->
                    <!--                                type="object"-->
                    <!--                                string="Send &amp; Print"-->
                    <!--                                attrs="{'invisible':['|', '|', ('state', '!=', 'posted'), ('invoice_sent', '=', True), ('type', 'not in', ('out_invoice', 'out_refund'))]}"-->
                    <!--                                class="oe_highlight"-->
                    <!--                                groups="base.group_user"/>-->
                    <!--                        <button name="action_invoice_sent"-->
                    <!--                                type="object"-->
                    <!--                                string="Send &amp; Print"-->
                    <!--                                attrs="{'invisible':['|', '|', ('state', '!=', 'posted'), ('invoice_sent', '=', False), ('type', 'not in', ('out_invoice', 'out_refund', 'in_invoice', 'in_refund'))]}"-->
                    <!--                                groups="base.group_user"/>-->
                    <!-- Register Payment (only invoices / receipts) -->
                    <!-- Cancel -->
                    <!--                        <button name="button_cancel" string="Cancel Entry" type="object" groups="account.group_account_invoice"-->
                    <!--                                attrs="{'invisible' : ['|', ('id', '=', False), ('state', '!=', 'draft')]}"/>-->
                    <!--                        <button name="button_draft" string="Reset to Draft" type="object" groups="account.group_account_invoice"-->
                    <!--                                attrs="{'invisible' : ['|', ('restrict_mode_hash_table', '=', True), ('state', 'not in', ('posted', 'cancel'))]}"/>-->
                    <field name="state" widget="statusbar" statusbar_visible="planning,confirmed,on_way,delivered"/>
                </header>
                <sheet>
                    <div>
                        <span class="o_form_label"><field name="type" readonly="1" nolabel="1"/></span>
                        <h1>
                            <span attrs="{'invisible': [('state', '!=', 'planning')]}">Planning</span>
                            <span attrs="{'invisible': [('state', '!=', 'confirmed')]}">Cargo transport confirmed</span>
                            <span attrs="{'invisible': [('state', '!=', 'on_way')]}">Cargo on the way</span>
                            <span attrs="{'invisible': [('state', '!=', 'delivered')]}">Cargo delivered</span>
                            <span attrs="{'invisible': [('state', '!=', 'cancelled')]}">Cargo cancelled</span>
                        </h1>
                    </div>
                    <group>
                        <group id="header_left_group">

                            <div class="o_td_label">
                                <label for="name"/>
                            </div>
                            <field name="name" nolabel="1"/>

                            <div class="o_td_label">
                                <label for="partner_id" string="Customer" style="font-weight:bold;"/>
                            </div>
                            <field name="partner_id" widget="res_partner_many2one" nolabel="1"
                                   context="{'show_address': 1, 'default_is_company': True, 'show_vat': True}"
                                   options='{"always_reload": True, "no_quick_create": True}'/>

                            <div class="o_td_label">
                                <label for="place_from"/>
                            </div>
                            <field name="place_from" nolabel="1" options='{"no_quick_create": True}'/>

                            <div class="o_td_label">
                                <label for="place_to"/>
                            </div>
                            <field name="place_to" nolabel="1" domain="[('partner_id', '=', partner_id)]"
                                   options='{"no_quick_create": True}'/>
                        </group>

                        <group id="header_right_group">
                            <div class="o_td_label">
                                <label for="date_of_departure" style="font-weight:bold;"/>
                            </div>
                            <field name="date_of_departure" nolabel="1"/>

                            <div class="o_td_label">
                                <label for="driver" style="font-weight:bold;"/>
                            </div>
                            <field name="driver" nolabel="1"/>


                            <div class="o_td_label">
                                <label for="type" style="font-weight:bold;"/>
                            </div>
                            <field name="type" nolabel="1"/>

                            <div class="o_td_label">
                                <label for="currency_id" style="font-weight:bold;"/>
                            </div>
                            <field name="currency_id" nolabel="1"/>

                        </group>
                    </group>
                    <notebook>
                        <page id="cargo_tab" string="Cargo lines">
                            <field name="cargo_ids"
                                   widget="section_and_note_one2many"
                                   mode="tree"
                                   context="{'default_currency_id': currency_id}">
                                <tree string="Cargo Items" default_order="sequence, id">
                                    <control>
                                        <create name="add_line_control" string="Add a line"/>
                                    </control>
                                    <field name="sequence" widget="handle"/>
                                    <field name="product_id"/>
                                    <field name="label"/>
                                    <field name="quantity"/>
                                     <field name="product_uom_id" string="UoM" optional="show"/>
                                    <field name="price_unit" string="Price"/>
                                    <field name="discount" string="Disc.%"/>
                                    <field name="tax_ids" widget="many2many_tags"/>
                                    <field name="price_net"
                                           string="Subtotal"/>
                                    <field name="price_vat"
                                           string="VAT"/>
                                    <field name="price_total"
                                           string="Total"/>
                                </tree>
                                <form>
                                    <sheet>
                                        <group>
                                            <field name="product_id" widget="many2one_barcode"/>
                                            <field name="label"/>
                                            <field name="quantity"/>
                                            <field name="product_uom_id"/>
                                            <field name="price_unit"/>
                                            <field name="discount"  string="Discount (%)"/>
                                            <field name="currency_id" invisible="1"/>
                                        </group>
                                        <group>
                                            <field name="tax_ids" widget="many2many_tags"/>
                                        </group>
                                    </sheet>
                                </form>
                            </field>

                            <!-- TABELKA PODSUMOWUJACA -->
                            <group class="oe_subtotal_footer">
                                <field name="total_net"/>
                                <field name="total_vat"/>
                                <field name="total_gross" class="oe_subtotal_footer_separator"/>
                            </group>
                        </page>

                        <page id="additional_info"
                              string="Other informations"><!--TODO groups="account.group_account_user"-->
                            <field name="internal_note" placeholder="Add an internal note..." nolabel="1" height="50"/>

                        </page>

                    </notebook>
                </sheet>

                <!-- Chatter -->
                <!--                <div class="oe_chatter">-->
                <!--        TODO-            <field name="message_follower_ids" widget="mail_followers" groups="base.group_user"/>-->
                <!--                    <field name="activity_ids" widget="mail_activity"/>-->
                <!--                    <field name="message_ids" widget="mail_thread"/>-->
                <!--                </div>-->
            </form>
        </field>
    </record>


    <record id="dm_f_transport_order_view_action" model="ir.actions.act_window">
        <field name="name">Transport orders</field>
        <field name="res_model">transport.order</field>
        <field name="view_mode">tree,form</field>
        <field name="view_id" ref="dm_f_transport_order_view_tree"/>
        <field name="help" type="html">
            <p class="o_view_nocontent_smiling_face">
                Create a transport order
            </p><p>
            Create transport order and keep an eye all the time.
        </p>
        </field>
    </record>

    <menuitem name="Transport" parent="fleet.menu_root" id="fleet_transport" sequence="1"/>
    <menuitem action="dm_f_transport_order_view_action" parent="fleet_transport" id="fleet_transport_orders" sequence="100"/>

</odoo>